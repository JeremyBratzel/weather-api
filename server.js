var express = require('express');
var request = require('request');
var apiKey = '';

  app = express();

  app.get('/', (req,res) => res.send('Hello World!'));

  var sampleCurrentBody = '{"coord":{"lon":-82.95,"lat":42.33},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"base":"stations","main":{"temp":267.84,"pressure":1035,"humidity":58,"temp_min":266.45,"temp_max":269.05},"visibility":16093,"wind":{"speed":3.1,"deg":100},"clouds":{"all":90},"dt":1549812960,"sys":{"type":1,"id":6182,"message":0.004,"country":"CA","sunrise":1549802057,"sunset":1549839500},"id":5946226,"name":"East Windsor","cod":200}';
  app.get('/current', (req, res) => {
        if(req.query.lat && req.query.lon){
                res.send(sampleCurrentBody);
                return;
                request(`http://api.openweathermap.org/data/2.5/weather?lat=${req.query.lat}&lon=${req.query.lon}&appid=${apiKey}`, function(error, response, body) {
                        console.log("calling current weather api");
                        console.log(error, response, body);
                        if(!error && response.statusCode == 200){
                                res.send(body);
                        } else{
                                res.send('error calling weather api. Please try again');
                        }
                })
        } else {
                res.send('didn\'t receive location information');
        }
  });
  var sampleForecastBody = '{"cod":"200","message":0.0049,"cnt":40,"list":[{"dt":1549821600,"main":{"temp":269.83,"temp_min":266.93,"temp_max":269.83,"pressure":1023.09,"sea_level":1048.55,"grnd_level":1023.09,"humidity":98,"temp_kf":2.9},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":92},"wind":{"speed":1.92,"deg":109.501},"sys":{"pod":"d"},"dt_txt":"2019-02-10 18:00:00"},{"dt":1549832400,"main":{"temp":269.96,"temp_min":267.783,"temp_max":269.96,"pressure":1019.18,"sea_level":1044.66,"grnd_level":1019.18,"humidity":92,"temp_kf":2.18},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":80},"wind":{"speed":2.72,"deg":93.5033},"snow":{"3h":0.007},"sys":{"pod":"d"},"dt_txt":"2019-02-10 21:00:00"},{"dt":1549843200,"main":{"temp":268.35,"temp_min":266.904,"temp_max":268.35,"pressure":1017.16,"sea_level":1042.78,"grnd_level":1017.16,"humidity":85,"temp_kf":1.45},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":92},"wind":{"speed":3,"deg":83.002},"snow":{"3h":0.4205},"sys":{"pod":"n"},"dt_txt":"2019-02-11 00:00:00"},{"dt":1549854000,"main":{"temp":267.32,"temp_min":266.591,"temp_max":267.32,"pressure":1016.07,"sea_level":1041.66,"grnd_level":1016.07,"humidity":87,"temp_kf":0.73},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":92},"wind":{"speed":2.67,"deg":93.5014},"snow":{"3h":0.37},"sys":{"pod":"n"},"dt_txt":"2019-02-11 03:00:00"},{"dt":1549864800,"main":{"temp":266.267,"temp_min":266.267,"temp_max":266.267,"pressure":1014.48,"sea_level":1040,"grnd_level":1014.48,"humidity":89,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":92},"wind":{"speed":2.88,"deg":68.0001},"snow":{"3h":0.3425},"sys":{"pod":"n"},"dt_txt":"2019-02-11 06:00:00"},{"dt":1549875600,"main":{"temp":266.581,"temp_min":266.581,"temp_max":266.581,"pressure":1014.17,"sea_level":1039.71,"grnd_level":1014.17,"humidity":91,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":92},"wind":{"speed":2.36,"deg":68.0006},"snow":{"3h":0.125},"sys":{"pod":"n"},"dt_txt":"2019-02-11 09:00:00"},{"dt":1549886400,"main":{"temp":266.523,"temp_min":266.523,"temp_max":266.523,"pressure":1014.15,"sea_level":1039.7,"grnd_level":1014.15,"humidity":92,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":92},"wind":{"speed":3.31,"deg":48.0095},"snow":{"3h":0.14},"sys":{"pod":"n"},"dt_txt":"2019-02-11 12:00:00"},{"dt":1549897200,"main":{"temp":268.08,"temp_min":268.08,"temp_max":268.08,"pressure":1014.27,"sea_level":1039.76,"grnd_level":1014.27,"humidity":97,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13d"}],"clouds":{"all":88},"wind":{"speed":4.56,"deg":68.0003},"snow":{"3h":0.0325},"sys":{"pod":"d"},"dt_txt":"2019-02-11 15:00:00"},{"dt":1549908000,"main":{"temp":270.559,"temp_min":270.559,"temp_max":270.559,"pressure":1013.72,"sea_level":1038.86,"grnd_level":1013.72,"humidity":99,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":92},"wind":{"speed":5.31,"deg":82.5056},"snow":{"3h":0.0049999999999999},"sys":{"pod":"d"},"dt_txt":"2019-02-11 18:00:00"},{"dt":1549918800,"main":{"temp":271.501,"temp_min":271.501,"temp_max":271.501,"pressure":1013.08,"sea_level":1038.18,"grnd_level":1013.08,"humidity":87,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":92},"wind":{"speed":4.96,"deg":81.005},"snow":{"3h":0.025},"sys":{"pod":"d"},"dt_txt":"2019-02-11 21:00:00"},{"dt":1549929600,"main":{"temp":270.727,"temp_min":270.727,"temp_max":270.727,"pressure":1012.61,"sea_level":1037.87,"grnd_level":1012.61,"humidity":89,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":92},"wind":{"speed":5.55,"deg":79.5017},"snow":{"3h":0.01},"sys":{"pod":"n"},"dt_txt":"2019-02-12 00:00:00"},{"dt":1549940400,"main":{"temp":269.993,"temp_min":269.993,"temp_max":269.993,"pressure":1011.95,"sea_level":1037.12,"grnd_level":1011.95,"humidity":87,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":92},"wind":{"speed":6.43,"deg":79.0048},"snow":{},"sys":{"pod":"n"},"dt_txt":"2019-02-12 03:00:00"},{"dt":1549951200,"main":{"temp":269.776,"temp_min":269.776,"temp_max":269.776,"pressure":1010.05,"sea_level":1035.25,"grnd_level":1010.05,"humidity":88,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":92},"wind":{"speed":7.32,"deg":82.5022},"snow":{"3h":0.105},"sys":{"pod":"n"},"dt_txt":"2019-02-12 06:00:00"},{"dt":1549962000,"main":{"temp":269.846,"temp_min":269.846,"temp_max":269.846,"pressure":1005.86,"sea_level":1030.97,"grnd_level":1005.86,"humidity":91,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":92},"wind":{"speed":8.27,"deg":86.0008},"snow":{"3h":0.58},"sys":{"pod":"n"},"dt_txt":"2019-02-12 09:00:00"},{"dt":1549972800,"main":{"temp":270.485,"temp_min":270.485,"temp_max":270.485,"pressure":1002.37,"sea_level":1027.28,"grnd_level":1002.37,"humidity":93,"temp_kf":0},"weather":[{"id":601,"main":"Snow","description":"snow","icon":"13n"}],"clouds":{"all":92},"wind":{"speed":8.86,"deg":92.0005},"snow":{"3h":4.2},"sys":{"pod":"n"},"dt_txt":"2019-02-12 12:00:00"},{"dt":1549983600,"main":{"temp":272.464,"temp_min":272.464,"temp_max":272.464,"pressure":995.67,"sea_level":1020.3,"grnd_level":995.67,"humidity":96,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":10.43,"deg":98.0021},"rain":{"3h":0.26},"snow":{"3h":2.0325},"sys":{"pod":"d"},"dt_txt":"2019-02-12 15:00:00"},{"dt":1549994400,"main":{"temp":275.383,"temp_min":275.383,"temp_max":275.383,"pressure":989.23,"sea_level":1013.43,"grnd_level":989.23,"humidity":92,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"moderate rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":8.77,"deg":114.509},"rain":{"3h":4.58},"snow":{},"sys":{"pod":"d"},"dt_txt":"2019-02-12 18:00:00"},{"dt":1550005200,"main":{"temp":278.188,"temp_min":278.188,"temp_max":278.188,"pressure":983.42,"sea_level":1007.71,"grnd_level":983.42,"humidity":86,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"moderate rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":6.37,"deg":146.002},"rain":{"3h":7.17},"snow":{},"sys":{"pod":"d"},"dt_txt":"2019-02-12 21:00:00"},{"dt":1550016000,"main":{"temp":277.07,"temp_min":277.07,"temp_max":277.07,"pressure":983.02,"sea_level":1006.99,"grnd_level":983.02,"humidity":87,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"moderate rain","icon":"10n"}],"clouds":{"all":92},"wind":{"speed":5.11,"deg":194.003},"rain":{"3h":3.49},"snow":{},"sys":{"pod":"n"},"dt_txt":"2019-02-13 00:00:00"},{"dt":1550026800,"main":{"temp":275.384,"temp_min":275.384,"temp_max":275.384,"pressure":982.21,"sea_level":1006.48,"grnd_level":982.21,"humidity":92,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":88},"wind":{"speed":5.01,"deg":214.501},"rain":{"3h":0.38},"snow":{},"sys":{"pod":"n"},"dt_txt":"2019-02-13 03:00:00"},{"dt":1550037600,"main":{"temp":273.602,"temp_min":273.602,"temp_max":273.602,"pressure":982.38,"sea_level":1006.82,"grnd_level":982.38,"humidity":94,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":80},"wind":{"speed":6.17,"deg":252.003},"rain":{"3h":0.13},"snow":{"3h":0.165},"sys":{"pod":"n"},"dt_txt":"2019-02-13 06:00:00"},{"dt":1550048400,"main":{"temp":270.636,"temp_min":270.636,"temp_max":270.636,"pressure":983.97,"sea_level":1008.55,"grnd_level":983.97,"humidity":90,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":92},"wind":{"speed":7.46,"deg":257.002},"rain":{},"snow":{"3h":0.6075},"sys":{"pod":"n"},"dt_txt":"2019-02-13 09:00:00"},{"dt":1550059200,"main":{"temp":268.617,"temp_min":268.617,"temp_max":268.617,"pressure":985.99,"sea_level":1010.73,"grnd_level":985.99,"humidity":87,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":92},"wind":{"speed":9.92,"deg":267.504},"rain":{},"snow":{"3h":0.265},"sys":{"pod":"n"},"dt_txt":"2019-02-13 12:00:00"},{"dt":1550070000,"main":{"temp":268.634,"temp_min":268.634,"temp_max":268.634,"pressure":989.72,"sea_level":1014.57,"grnd_level":989.72,"humidity":91,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13d"}],"clouds":{"all":92},"wind":{"speed":11.58,"deg":292.503},"rain":{},"snow":{"3h":1.195},"sys":{"pod":"d"},"dt_txt":"2019-02-13 15:00:00"},{"dt":1550080800,"main":{"temp":269.568,"temp_min":269.568,"temp_max":269.568,"pressure":994.85,"sea_level":1019.7,"grnd_level":994.85,"humidity":92,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13d"}],"clouds":{"all":88},"wind":{"speed":9.31,"deg":300.502},"rain":{},"snow":{"3h":1.0425},"sys":{"pod":"d"},"dt_txt":"2019-02-13 18:00:00"},{"dt":1550091600,"main":{"temp":269.487,"temp_min":269.487,"temp_max":269.487,"pressure":998.17,"sea_level":1023.08,"grnd_level":998.17,"humidity":89,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13d"}],"clouds":{"all":88},"wind":{"speed":8.27,"deg":288.001},"rain":{},"snow":{"3h":0.095000000000001},"sys":{"pod":"d"},"dt_txt":"2019-02-13 21:00:00"},{"dt":1550102400,"main":{"temp":268.798,"temp_min":268.798,"temp_max":268.798,"pressure":1000.77,"sea_level":1025.9,"grnd_level":1000.77,"humidity":83,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":8},"wind":{"speed":7.12,"deg":284.006},"rain":{},"snow":{"3h":0.0375},"sys":{"pod":"n"},"dt_txt":"2019-02-14 00:00:00"},{"dt":1550113200,"main":{"temp":267.248,"temp_min":267.248,"temp_max":267.248,"pressure":1002.21,"sea_level":1027.51,"grnd_level":1002.21,"humidity":77,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":5.68,"deg":277.5},"rain":{},"snow":{},"sys":{"pod":"n"},"dt_txt":"2019-02-14 03:00:00"},{"dt":1550124000,"main":{"temp":267.097,"temp_min":267.097,"temp_max":267.097,"pressure":1003.31,"sea_level":1028.63,"grnd_level":1003.31,"humidity":83,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":64},"wind":{"speed":4.62,"deg":261.503},"rain":{},"snow":{},"sys":{"pod":"n"},"dt_txt":"2019-02-14 06:00:00"},{"dt":1550134800,"main":{"temp":269.013,"temp_min":269.013,"temp_max":269.013,"pressure":1003.52,"sea_level":1028.88,"grnd_level":1003.52,"humidity":89,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":76},"wind":{"speed":4.13,"deg":253.501},"rain":{},"snow":{"3h":0.045},"sys":{"pod":"n"},"dt_txt":"2019-02-14 09:00:00"},{"dt":1550145600,"main":{"temp":267.752,"temp_min":267.752,"temp_max":267.752,"pressure":1002.67,"sea_level":1027.93,"grnd_level":1002.67,"humidity":86,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":88},"wind":{"speed":2.71,"deg":212.501},"rain":{},"snow":{"3h":0.1125},"sys":{"pod":"n"},"dt_txt":"2019-02-14 12:00:00"},{"dt":1550156400,"main":{"temp":269.448,"temp_min":269.448,"temp_max":269.448,"pressure":1002.59,"sea_level":1027.56,"grnd_level":1002.59,"humidity":100,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13d"}],"clouds":{"all":100},"wind":{"speed":2.82,"deg":193.001},"rain":{},"snow":{"3h":0.545},"sys":{"pod":"d"},"dt_txt":"2019-02-14 15:00:00"},{"dt":1550167200,"main":{"temp":273.016,"temp_min":273.016,"temp_max":273.016,"pressure":1000.19,"sea_level":1024.85,"grnd_level":1000.19,"humidity":98,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13d"}],"clouds":{"all":76},"wind":{"speed":3.07,"deg":204.002},"rain":{},"snow":{"3h":0.17},"sys":{"pod":"d"},"dt_txt":"2019-02-14 18:00:00"},{"dt":1550178000,"main":{"temp":274.872,"temp_min":274.872,"temp_max":274.872,"pressure":998.96,"sea_level":1023.41,"grnd_level":998.96,"humidity":92,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":2.75,"deg":200.503},"rain":{"3h":0.039999999999999},"snow":{"3h":0.165},"sys":{"pod":"d"},"dt_txt":"2019-02-14 21:00:00"},{"dt":1550188800,"main":{"temp":275.184,"temp_min":275.184,"temp_max":275.184,"pressure":999.31,"sea_level":1023.89,"grnd_level":999.31,"humidity":92,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":92},"wind":{"speed":2.72,"deg":192.503},"rain":{"3h":0.37},"snow":{"3h":0.0050000000000008},"sys":{"pod":"n"},"dt_txt":"2019-02-15 00:00:00"},{"dt":1550199600,"main":{"temp":275.33,"temp_min":275.33,"temp_max":275.33,"pressure":999.28,"sea_level":1023.87,"grnd_level":999.28,"humidity":94,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":92},"wind":{"speed":3.12,"deg":186.001},"rain":{"3h":0.21},"snow":{},"sys":{"pod":"n"},"dt_txt":"2019-02-15 03:00:00"},{"dt":1550210400,"main":{"temp":275.031,"temp_min":275.031,"temp_max":275.031,"pressure":998.44,"sea_level":1023.01,"grnd_level":998.44,"humidity":91,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":80},"wind":{"speed":2.87,"deg":165.002},"rain":{"3h":0.38},"snow":{},"sys":{"pod":"n"},"dt_txt":"2019-02-15 06:00:00"},{"dt":1550221200,"main":{"temp":275.076,"temp_min":275.076,"temp_max":275.076,"pressure":996.62,"sea_level":1021.11,"grnd_level":996.62,"humidity":93,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":92},"wind":{"speed":3.91,"deg":148.501},"rain":{"3h":0.45},"snow":{},"sys":{"pod":"n"},"dt_txt":"2019-02-15 09:00:00"},{"dt":1550232000,"main":{"temp":275.293,"temp_min":275.293,"temp_max":275.293,"pressure":994.43,"sea_level":1018.83,"grnd_level":994.43,"humidity":94,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":92},"wind":{"speed":5.01,"deg":138.502},"rain":{"3h":1.09},"snow":{},"sys":{"pod":"n"},"dt_txt":"2019-02-15 12:00:00"},{"dt":1550242800,"main":{"temp":275.883,"temp_min":275.883,"temp_max":275.883,"pressure":991.92,"sea_level":1016.17,"grnd_level":991.92,"humidity":92,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":6.11,"deg":132.501},"rain":{"3h":2.92},"snow":{},"sys":{"pod":"d"},"dt_txt":"2019-02-15 15:00:00"}],"city":{"id":5946226,"name":"East Windsor","coord":{"lat":42.3168,"lon":-82.9832},"country":"CA"}}';
  app.get('/forecast', (req, res) => {
        if(req.query.lat && req.query.lon){
                res.send(sampleForecastBody);
                return;
                request(`http://api.openweathermap.org/data/2.5/forecast?lat=${req.query.lat}&lon=${req.query.lon}&appid=${apiKey}`, function(error, response, body) {
                        console.log("calling current weather api");
                        console.log(error, response, body);
                        if(!error && response.statusCode == 200){
                                res.send(body);
                        } else{
                                res.send('error calling weather api. Please try again');
                        }
                })
        } else {
                res.send('didn\'t receive location information');
        }
  });

app.listen(3000, () => console.log('weather api now listening on port 3000!'));